# 融资融券模拟撮合规则

1. 当前模拟撮合的两融业务支持交易委托类型和非交易委托类型，其中交易委托类型包括：担保品买入、担保品卖出、融资买入、卖券还款、融券卖出、买券还券；非交易委托类型：现券还券、余券划转、担保品转入、担保品转出。
2. 模拟撮合针对交易委托类型撮合规则:模拟撮合当前测试环境按照轮循的方式，对所有报单进行未成交(订单确认)、部成、全成、拒单4种方式进行撮合,给出撮合结果如:订单确认(成功或废单)，有成交的会有成交回报信息推送。
3. 模拟撮合针对非交易委托类型撮合规则:模拟撮合当前测试环境对所有报单进行订单确认(成功或废单)，没有成交回报信息推送。

模拟撮合可采取的撮合策略是怎样的？

答：模拟撮合目前测试环境默认采用轮询模式进行撮合，主要包括未成交(订单确认)、部成、全成、拒单4种方式。

如果用户想要设置不同的撮合方式，请至XTP官网的个人中心中设置测试账号的模拟撮合默认撮合方式。如果不设置就默认轮询模式。如果设置指定模式那么设置模式将于设置完成当日10分钟后生效。

设置模式包括上交所和深交所，其中上交所对应关系如下：

| 设置模式 | 撮合模式 |
| --- | --- |
| alternate match | 轮询（未成、部成、全成、拒单轮流来） |
| all matched | 全部成交 |
| match half | 部分成交 |
| not match | 全部订单都是未成交 |
| match error | 全部拒单 |

深交所对应关系如下：

| 设置模式 | 撮合模式 |
| --- | --- |
| auto | 轮询（未成、部成、全成、拒单轮流来）|
| fail | 全部拒单 |
| pending | 全部订单都是未成交 |
| report | 全部成交 |
| part | 部分成交 |
| cancel | 撤单 |

> （注：2019年4月13日之前申请的测试账号适用以下规则：模拟撮合目前默认采取轮询的方式进行撮合，上交所和深交所模拟撮合会每单去轮循一次，然后轮询按照不成交、部分成交、全部成交、拒单等方式给用户的订单进行模拟撮合，确保用户下单时，所有可能的报单情况都能给到用户。）

模拟撮合针对api下单用户新增自定义撮合方式，利用api的InsertOrder时报单所填的order_client_id数值，按如下模式撮合：

- 深圳：1-未成交 2-全成 3-部成 4-撤单 5-废单
- 上海：1-未成交 2-全成 3-部分 4-废单
